启动matlab:

​      $  sudo matlab 

查看发送的pose:

rostopic echo /ros_msg

shadow手放入箱子需要把手闭合：

```bash
$ roslaunch sr_ethercat_hand_config sr_rhand.launch
```

进入rviz选择`hand_pack`，update->plan->execute，让手张开同理。

---

查看shadow的关节信息

```bash
rostopic echo /joint_states
```

查看UR的关节信息

```
rostopic echo /ur5/joint_states
```

---

实验用的两个launch：

```bash
roslaunch sr_edc_launch sr_edc_true.launch
```

```
roslaunch ur_sr_moveit_config moveit_execution.launch robot_ip:=192.168.1.101

roslaunch ur5_moveit_config moveit_rviz.launch config:=true // 用rviz
```

---

shadow恢复张开的状态：(控制前先运行,防止rviz误碰)

```bash
rosrun demo_z demo_sr_recover.py
```

UR恢复起始的状态：

```bash
rosrun demo_z demo_ur_recover.py 
```

---

控制ur到目标位置:

`rosrun demo_z demo_ur_drive.py`

shadow闭合状态的关节角：

```
name: ['rh_FFJ4', 'rh_FFJ3', 'rh_FFJ2', 'rh_FFJ1', 'rh_MFJ4', 'rh_MFJ3', 'rh_MFJ2', 'rh_MFJ1', 'rh_RFJ4', 'rh_RFJ3', 'rh_RFJ2', 'rh_RFJ1', 'rh_THJ5', 'rh_THJ4', 'rh_THJ2', 'rh_THJ1']
position: [0.006279309025043004, 1.5630532764973097, 1.7387672230683742, 1.3721092914116135, 0.007428413470550299, 1.5592956053081821, 1.708120545548438, 1.4083301137912208, -0.008999302022796007, 1.557830482436094, 1.7456891136957715, 1.3673572420844116, 0.17207435310006847, 1.1919580888729926, 0.6020144426347245, 0.512015020403631]
```

---

对于每个手指的第四个link，面向手背：

- `joints_states['rh_FFJ4'] += 0.349`表示食指向右动；
- `joints_states['rh_MFJ4'] += 0.349`表示中指向右动；
- `joints_states['rh_RFJ4'] -= 0.349`表示无名指向右动；

---

- `joints_states['rh_THJ4'] += 0.4`表示大拇指向前动；
- `joints_states['rh_THJ5'] += 0.4`表示大拇指向掌心动；

---

目前来说，有这么几个问题：

- shadow的坐标系和UR的末端坐标系怎么转换？

---

- 确定UR5末端在世界坐标系下的位置；（怎么确定？）
- 根据末端位置，反解得到UR5的关节角；
- 驱动关节，使末端达到预期位置，就可以获取末端坐标系与世界坐标系之间的转换关系；
- 抓取点在世界坐标系下的位置应该转换到UR5的末端坐标系，再转换到Shadow的rh_palm坐标系；
- 根据抓取点在rh_palm坐标系下的位置，反解得到Shadow的关节角。

---

在rivz里面看，需要添加motion planning和TF，记得固定frame为ur5_arm_base，

ur grasp joint_states:

position: [-1.4270318190204065, -1.4694893995868128, -1.8055971304522913, -2.965193573628561, -2.1923440138446253, -3.0682340304004114]

shadow joint_states:

一.'rh_FFJ1': 0.0, 'rh_FFJ2': 0.91200805, '**rh_FFJ3': 1.2867566,** 'rh_FFJ4': 0.024128526,

 'rh_MFJ1': 0.0, '**rh_MFJ3': 1.57,** 'rh_MFJ2': 0.22466809, 'rh_MFJ4': 0.08069688, 

**'rh_THJ4': 0.78951174**, 'rh_THJ5': 0.31508297, 'rh_THJ1': 0.24411601, 'rh_THJ2': -0.5236,

 'rh_RFJ4': 0.349, 'rh_RFJ1': 0.07477686, 'rh_RFJ2': 0.89510554, 'rh_RFJ3': 0.30955532`

二. 'rh_FFJ1': -0.48122886, 'rh_FFJ2': 0.91200805, **'rh_FFJ3': 1.2867566,** 'rh_FFJ4': 0.024128526, 

'rh_MFJ1': -0.18435207, **'rh_MFJ3': 1.6119777**, 'rh_MFJ2': 0.22466809, 'rh_MFJ4': 0.08069688, 

**'rh_THJ4': 0.78951174**, 'rh_THJ5': 0.31508297, 'rh_THJ1': 0.24411601, **'rh_THJ2': -0.6420995**,

 'rh_RFJ4': 0.35174778, 'rh_RFJ1': 0.07477686, 'rh_RFJ2': 0.89510554, 'rh_RFJ3': 0.30955532}

三. 'rh_FFJ1': 0.0, 'rh_FFJ2': 0.96821624, **'rh_FFJ3': 1.1056641,** 'rh_FFJ4': 0.08202031, 'rh_MFJ1': 0.0, **'rh_MFJ3': 1.4424226,** 'rh_MFJ2': 0.31104028, 'rh_MFJ4': 0.15741783, **'rh_THJ4': 0.74761134,** 'rh_THJ5': 0.3535304, 'rh_THJ1': 0.2446045, **'rh_THJ2': -0.5236**, 'rh_RFJ4': 0.349, 'rh_RFJ1': 0.18469444, 'rh_RFJ2': 0.9954017, 'rh_RFJ3': 0.2583495}

四.{'rh_FFJ1': 0.0, 'rh_FFJ2': 1.0714239, **'rh_FFJ3': 0.874509,** 'rh_FFJ4': 0.11588389, 'rh_MFJ1': 0.071952984, **'rh_MFJ3': 1.2154493,** 'rh_MFJ2': 0.3501803, 'rh_MFJ4': 0.22790009, **'rh_THJ4': 0.7244842**, 'rh_THJ5': 0.3719309, 'rh_THJ1': 0.26830176, '**rh_THJ2': -0.5236**, 'rh_RFJ4': 0.349, 'rh_RFJ1': 0.33444676, 'rh_RFJ2': 1.0589471, 'rh_RFJ3': 0.14500186}

五.{'rh_FFJ1': 0.42574564, 'rh_FFJ2': 1.1327708, 'rh_FFJ3': 0.36828414, 'rh_FFJ4': 0.25238824, 'rh_MFJ1': 0.5071499, 'rh_MFJ3': 0.48574093, 'rh_MFJ2': 0.35590684, 'rh_MFJ4': 0.349, 'rh_THJ4': 0.6675353, 'rh_THJ5': 0.5959149, 'rh_THJ1': 0.03277241, 'rh_THJ2': -0.5236, 'rh_RFJ4': 0.13269216, 'rh_RFJ1': 0.26325756, 'rh_RFJ2': 1.157, 'rh_RFJ3': 0.0}

六.{'rh_FFJ1': 0.3723521, 'rh_FFJ2': 1.1223296, 'rh_FFJ3': 0.43741962, 'rh_FFJ4': 0.2692762, 'rh_MFJ1': 0.46189028, 'rh_MFJ3': 0.5578121, 'rh_MFJ2': 0.35245606, 'rh_MFJ4': 0.349, 'rh_THJ4': 0.6698724, 'rh_THJ5': 0.5660193, 'rh_THJ1': 0.02712107, **'rh_THJ2': -0.5236,** 'rh_RFJ4': 0.12852325, 'rh_RFJ1': 0.20175043, 'rh_RFJ2': 1.157, 'rh_RFJ3': 0.0}

02: 预处理patch后.{'rh_FFJ1': 0.8943935, 'rh_FFJ2': 1.0857395, 'rh_FFJ3': 0.34992978, **'rh_FFJ4': 0.348746**, 'rh_MFJ1': 0.9596253, 'rh_MFJ3': 0.4843388, 'rh_MFJ2': 1.0990025, '**rh_MFJ4': 0.349**, 'rh_THJ4': 1.222, 'rh_THJ5': -0.08402716, 'rh_THJ1': 1.4067076, 'rh_THJ2': 0.019767988, '**rh_RFJ4': 0.31078824**, 'rh_RFJ1': 1.0549294, 'rh_RFJ2': 1.029555, 'rh_RFJ3': 0.42839023}一

d=0.4 {'rh_FFJ1': 0.79218566, 'rh_FFJ2': 1.0156331, 'rh_FFJ3': 0.45458058, 'rh_FFJ4': 0.349, 'rh_MFJ1': 0.84224296, 'rh_MFJ3': 0.57127744, 'rh_MFJ2': 1.0647177, 'rh_MFJ4': 0.349, 'rh_THJ4': 1.222, 'rh_THJ5': -0.11119593, 'rh_THJ1': 1.3520882, 'rh_THJ2': -0.05010904, 'rh_RFJ4': 0.30661204, 'rh_RFJ1': 0.9907945, 'rh_RFJ2': 0.98448956, 'rh_RFJ3': 0.5403921}四

绕y轴旋转30°,d=0.4 {'rh_FFJ1': 0.3104424, 'rh_FFJ2': 0.6374454, 'rh_FFJ3': 1.4717, 'rh_FFJ4': 0.07154511, 'rh_MFJ1': 0.24754018, 'rh_MFJ3': 1.57, 'rh_MFJ2': 0.20529379, 'rh_MFJ4': 0.349, 'rh_THJ4': 1.222, 'rh_THJ5': 0.029615287, 'rh_THJ1': 0.44799215, 'rh_THJ2': -0.02731984, 'rh_RFJ4': 0.09755459, 'rh_RFJ1': 0.51677316, 'rh_RFJ2': 0.8612309, 'rh_RFJ3': 0.69993037}三

002:{'rh_FFJ1': 0.6976773, 'rh_FFJ2': 0.962967, 'rh_FFJ3': 0.4357134, '**rh_FFJ4': 0.349**, 'rh_MFJ1': 0.7941973, 'rh_MFJ3': 0.61565745, 'rh_MFJ2': 0.9545403, '**rh_MFJ4': 0.349**, 'rh_THJ4': 1.222, 'rh_THJ5': -0.07961288, 'rh_THJ1': 1.3235085, 'rh_THJ2': -0.03715094, '**rh_RFJ4': 0.23061126,** 'rh_RFJ1': 0.96174634, 'rh_RFJ2': 0.94429153, 'rh_RFJ3': 0.47934574}二

d=0.4 {'rh_FFJ1': 0.59610003, 'rh_FFJ2': 0.92303705, 'rh_FFJ3': 0.5264338, 'rh_FFJ4': 0.349, 'rh_MFJ1': 0.69448656, 'rh_MFJ3': 0.69052166, 'rh_MFJ2': 0.893128, 'rh_MFJ4': 0.349, 'rh_THJ4': 1.222, 'rh_THJ5': -0.10856005, 'rh_THJ1': 1.2715367, 'rh_THJ2': -0.11889221, 'rh_RFJ4': 0.24882697, 'rh_RFJ1': 0.8864921, 'rh_RFJ2': 0.90926456, 'rh_RFJ3': 0.579673}五